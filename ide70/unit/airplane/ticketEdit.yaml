---
- compType: page
  tree:
    - ticketHeader:
      - textboxTicketCode
    - cnrRepeat:
      - labeledTable:
        - inPrefixSuggestFlight
        - inPrefixSuggestSeat
    - buttonSave
  inputs:
    ticketId: Id of ticket database entity
- compType: hlp/dbhelper
  tableName: ticket
  dbIdInputName: ticketId
  cr: hlpDbhelper
- compType: labeledTable
  cr: ticketHeader
- compType: textbox
  label: Ticket code
  store: ticket_code
  cr: textboxTicketCode
- compType: cnr/repeat
  cr: cnrRepeat
  store: reservations
- compType: labeledTable
  cr: labeledTable
- compType: in/prefixSuggest
  eventHandlers:
    filter: 
      action: |
        var q = CompCtx().DBCtx().QueryCtx();
        var flight = q.Table("flight");
        var searchText = Event().GetParam("searchPrefix");
        q.From(flight).Select(flight._id,flight.flight_id,flight.destination,flight.departure).
        Where(flight.destination.Like("%"+searchText+"%")).
        AscendingBy(flight.departure).List();
    initDescr:
      action: |
        var dataKey = Event().GetParam("dataKey");
        var q = CompCtx().DBCtx().QueryCtx();
        var flight = q.Table("flight");
        q.From(flight).Select(flight.flight_id).
        Where(flight._id.Equals(dataKey)).OneRow().
        GetOneColumnForConvert().AsString();
  searchResultDisplayColumns:
    - flight_id
    - destination
    - departure
  descrColumn: flight_id
  keyColumn: id
  label: Flight
  store: flight
  cr: inPrefixSuggestFlight
- compType: in/prefixSuggest
  eventHandlers:
    filter: 
      action: |
        var q = CompCtx().DBCtx().QueryCtx();
        var flightId = CompByCr("inPrefixSuggestFlight").GetProp("value");
        var airplane = q.Table("airplane");
        var flight = airplane.JoinedTable("flightMConn");
        var seat = airplane.JoinedTable("seatMConn");
        var searchText = Event().GetParam("searchPrefix");
        q.From(airplane).Select(seat._id, seat.code, seat.class, seat.window).
        Where(flight._id.Equals(flightId).And(seat.code.Like('%'+searchText+'%').OrEmpty(searchText))).
        AscendingBy(seat.code).List();
    initDescr:
      action: |
        var q = CompCtx().DBCtx().QueryCtx();
        var dataKey = Event().GetParam("dataKey");
        var seat = q.Table("seat");
        q.From(seat).Select(seat.code).Where(seat._id.Equals(dataKey)).OneRow().GetOneColumnForConvert().AsString();
  searchResultDisplayColumns:
    - code
    - class
    - window
  descrColumn: code
  keyColumn: id
  minPrefixLength: 0
  label: Seat
  store: seat
  cr: inPrefixSuggestSeat
- compType: button
  text: Save
  eventHandlers:
    onclick:
      action: |
        CompByCr("hlpDbhelper").ForwardEvent("saveData");
  cr: buttonSave
