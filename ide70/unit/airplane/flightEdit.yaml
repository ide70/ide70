---
- compType: page
  tree:
    - labeledTable:
      - textboxFlightID
      - inSelectionDestination
      - inTimestampDeparture
      - textboxDummyForTesting
      - inPrefixSuggestAirplaneType
      - inPrefixSuggestSuggestTest  
      - buttonSave
  inputs:
    flightId: Id of flight database entity
- compType: hlp/dbhelper
  tableName: flight
  dbIdInputName: flightId
- compType: labeledTable
  cr: labeledTable
- compType: textbox
  label: Flight ID
  cr: textboxFlightID
  store: flight_id
- compType: in/selection
  dictionaryFile: airport
  label: Destination
  cr: inSelectionDestination
  store: destination
- compType: in/timestamp
  label: Departure
  cr: inTimestampDeparture
  startYear:
    calc: |
      2020 + 1
  endYear: 2033
  store: departure
- compType: in/prefixSuggest
  eventHandlers:
    filter: 
      action: |
        var airplane = Event().DBCtx().QueryCtx().Table("airplane");
        var q = Event().DBCtx().QueryCtx();
        var searchText = Event().GetParam("searchPrefix");
        q.From(airplane).Select(airplane._id, airplane.code, airplane.name).Where(airplane.name.Like("%"+searchText+"%")).
        AscendingBy(airplane.code).List();
  label: Airplane type
  cr: inPrefixSuggestAirplaneType
  descrColumn: code
- compType: in/prefixSuggest
  eventHandlers:
    filter: 
      action: |
        var t1 = Event().DBCtx().QueryCtx().Table("flight");
        var q = Event().DBCtx().QueryCtx();
        q.From(t1).Select(t1.flight_id).Where(t1.destination.Like("B%")).List();
        
        Api().Logger().Info("searchPrefix:", Event().GetParam("searchPrefix"));
        var crit = Api().Arrays().Like(Event().GetParam("searchPrefix"));
        Api().Arrays().NewITableW().AddCol("code", "C1").AddCol("descr", "alma")
        .AddEmptyRow().AddCol("code", "C2").AddCol("descr", "k√∂rte")
        .AddEmptyRow().AddCol("code", "C3").AddCol("descr", "almamoly")
        .Finalize().FilterColumn("descr", crit);
    test:
      action: |
        var t1 = Event().DBCtx().QueryCtx().Table("flight");
        var q = Event().DBCtx().QueryCtx();
        q.From(t1).Select(t1.flight_id).Where(t1.destination.Like("B%").And(t1.flight_id.Equals(t1.departure))).List();
  label: SuggestTest
  cr: inPrefixSuggestSuggestTest
  descrColumn: descr
- compType: textbox
  label: Dummy for testing
  cr: textboxDummyForTesting
- compType: button
  text: Save
  eventHandlers:
    onclick:
      action: |
        var formData = Event().GetUnit().CollectStored();
        Event().DBCtx().CreateDBO(formData, "flight").Save();
        Event().LoadParent();
  cr: buttonSave