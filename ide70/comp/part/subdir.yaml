---
include:
  - common
body: |
  <div id="{{.sid}}" class="grp">
  {{if .parentContext.isOpen}}
  <i class="fas fa-folder fa-fw"{{template "eventHandlers" .}}></i>
  <span class="fs-dir open">{{.parentContext.name}}</span>
  <ul>
  {{range $i, $entry := .parentContext.Files}}
  <li>
    {{if $entry.isDir}}
    {{generateComp $.This "subdir" $i $entry}}
    {{else}}
    {{generateComp $.This "fileEntry" $i $entry}}
    {{end}}
  </li>
  {{end}}
  </ul>
  {{else}}
  <i class="fas fa-folder fa-fw"{{template "eventHandlers" .}}></i>
  <span class="fs-dir"{{eventHandler $.This "onclick" "onclick_dirname"}}>{{.parentContext.name}}</span>
  {{end}}
  </div>
eventHandlers:
  onclick:
    action: |
        isOpen = Event().Comp.State.parentContext.isOpen;
        Event().Comp.State.parentContext.isOpen = !isOpen;
        if(!isOpen) {
          files = Event().FileCtx().ReadDir(Event().Comp.State.parentContext.path);
          Event().Comp.State.parentContext.Files = files;
        }
        Event().CurrentComp().Refresh();
  onclick_dirname:
    action: |
        common_log("click on dir name");
        dirNameCr = Event().CompProps().dirClickCompCr;
        common_log("registeredComp:" + dirNameCr);
        if(dirNameCr) {
            dirNameComp = CompByCr(dirNameCr);
            common_log("dirNameComp:" + dirNameComp);
            if(dirNameComp) {
                common_log("FWD:"+Event().Comp.State.parentContext.path);
                dirNameComp.ForwardEvent("display").
                    AddForwardParam("path", Event().Comp.State.parentContext.path);
            }
        }
